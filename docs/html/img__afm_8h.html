<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>Bsoft: /usr/local/bsoft/include/img_afm.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Bsoft_icon128.jpg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Bsoft
   &#160;<span id="projectnumber">1.9</span>
   </div>
   <div id="projectbrief">Bernard&#39;s software package</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('img__afm_8h.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">img_afm.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Header file for AFM functions.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="rwimg_8h_source.html">rwimg.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="ps__plot_8h_source.html">ps_plot.h</a>&quot;</code><br />
</div>
<p><a href="img__afm_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a97ff964041dc379d234451976b2e81af"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="img__afm_8h.html#a97ff964041dc379d234451976b2e81af">img_to_surface</a> (<a class="el" href="class_bimage.html">Bimage</a> *p, <a class="el" href="class_bimage.html">Bimage</a> *psd, int nz, double density, double resolution)</td></tr>
<tr class="memdesc:a97ff964041dc379d234451976b2e81af"><td class="mdescLeft">&#160;</td><td class="mdescRight">Converts a 2D AFM image to a 3D density map.  <a href="#a97ff964041dc379d234451976b2e81af">More...</a><br /></td></tr>
<tr class="separator:a97ff964041dc379d234451976b2e81af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13429ae13d7e4510f96ed2bbe97aca5a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="img__afm_8h.html#a13429ae13d7e4510f96ed2bbe97aca5a">img_3D_to_height</a> (<a class="el" href="class_bimage.html">Bimage</a> *p, double threshold)</td></tr>
<tr class="memdesc:a13429ae13d7e4510f96ed2bbe97aca5a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Converts a 3D image to a 2D height image.  <a href="#a13429ae13d7e4510f96ed2bbe97aca5a">More...</a><br /></td></tr>
<tr class="separator:a13429ae13d7e4510f96ed2bbe97aca5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa25fa0381c6ab615fe8397f1cb5be31c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="img__afm_8h.html#aa25fa0381c6ab615fe8397f1cb5be31c">afm_generate_tip</a> (<a class="el" href="singleton_vector3.html">Vector3</a>&lt; int &gt; size, <a class="el" href="singleton_vector3.html">Vector3</a>&lt; float &gt; sampling, double radius, double resolution)</td></tr>
<tr class="memdesc:aa25fa0381c6ab615fe8397f1cb5be31c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates a rounded conical AFM tip.  <a href="#aa25fa0381c6ab615fe8397f1cb5be31c">More...</a><br /></td></tr>
<tr class="separator:aa25fa0381c6ab615fe8397f1cb5be31c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0046c7edea078130d85ed89218cd780"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_bplot.html">Bplot</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="img__afm_8h.html#ab0046c7edea078130d85ed89218cd780">afm_simulate</a> (<a class="el" href="class_bimage.html">Bimage</a> *ptip, <a class="el" href="class_bimage.html">Bimage</a> *p, double spring, double modulus, double thick)</td></tr>
<tr class="memdesc:ab0046c7edea078130d85ed89218cd780"><td class="mdescLeft">&#160;</td><td class="mdescRight">Simulates and AFM experiment.  <a href="#ab0046c7edea078130d85ed89218cd780">More...</a><br /></td></tr>
<tr class="separator:ab0046c7edea078130d85ed89218cd780"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f184db68cc1c8829d48c0cbc7e213d4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="img__afm_8h.html#a0f184db68cc1c8829d48c0cbc7e213d4">afm_force_to_height</a> (<a class="el" href="class_bimage.html">Bimage</a> *pf, double force_step)</td></tr>
<tr class="memdesc:a0f184db68cc1c8829d48c0cbc7e213d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Converts an AFM force map into a set of 2D height images at different constant force values.  <a href="#a0f184db68cc1c8829d48c0cbc7e213d4">More...</a><br /></td></tr>
<tr class="separator:a0f184db68cc1c8829d48c0cbc7e213d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Header file for AFM functions. </p>
<dl class="section author"><dt>Author</dt><dd>Bernard Heymann </dd></dl>
<dl class="section date"><dt>Date</dt><dd>Created: 19990124 </dd>
<dd>
Modified: 20141230 </dd></dl>

<p>Definition in file <a class="el" href="img__afm_8h_source.html">img_afm.h</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a0f184db68cc1c8829d48c0cbc7e213d4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_bimage.html">Bimage</a>* afm_force_to_height </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>pf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>force_step</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Converts an AFM force map into a set of 2D height images at different constant force values. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*pf</td><td>force map. </td></tr>
    <tr><td class="paramname">force_step</td><td>force intervals for height images </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Bimage* ph height images. </dd></dl>

<p>Definition at line <a class="el" href="img__afm_8cpp_source.html#l00400">400</a> of file <a class="el" href="img__afm_8cpp_source.html">img_afm.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="aa25fa0381c6ab615fe8397f1cb5be31c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_bimage.html">Bimage</a>* afm_generate_tip </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="singleton_vector3.html">Vector3</a>&lt; int &gt;&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="singleton_vector3.html">Vector3</a>&lt; float &gt;&#160;</td>
          <td class="paramname"><em>sampling</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>radius</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>resolution</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Generates a rounded conical AFM tip. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">size</td><td>size of the tip density </td></tr>
    <tr><td class="paramname">sampling</td><td>sampling/spacing (in angstrom/pixel) </td></tr>
    <tr><td class="paramname">radius</td><td>radius of the tip curvature (in angstrom) </td></tr>
    <tr><td class="paramname">resolution</td><td>the resolution affects the tip surface softness </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Bimage* tip 3D map. <pre class="fragment">A 2D image of a conical tip is generated, with a 45 degree angle and
a rounding tip with the desired radius and softness.
The 2D image is then converted to a 3D surface using the function 
img_to_surface and returned.  The density of beta-silicon nitride
of 1.925 Da/A3 is used.</pre> </dd></dl>

<p>Definition at line <a class="el" href="img__afm_8cpp_source.html#l00165">165</a> of file <a class="el" href="img__afm_8cpp_source.html">img_afm.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ab0046c7edea078130d85ed89218cd780"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_bplot.html">Bplot</a>* afm_simulate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>ptip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>spring</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>modulus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>thick</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Simulates and AFM experiment. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*ptip</td><td>AFM tip density map - converted to force map. </td></tr>
    <tr><td class="paramname">*p</td><td>specimen density map. </td></tr>
    <tr><td class="paramname">spring</td><td>AFM cantilever spring constant (N/m). </td></tr>
    <tr><td class="paramname">modulus</td><td>bulk modules (N/m2). </td></tr>
    <tr><td class="paramname">thick</td><td>sample thickness (angstrom). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Bplot* force curve. <pre class="fragment">The elastic force on an AFM tip is calculated as:
    F = kt*dz = kb*dV/d
where   kt is the cantilever spring constant, typically 0.01 - 0.1 N/m.
        dz is the tip displacement due to specimen interaction.
        kb is the bulk modulus of the specimen, typically 1e9 N/m2.
        dV is the volume of the specimen displaced by the tip. This
            volume is here approximated as the density overlap volume.
        d is the specimen thickness in angstrom.
The tip is positioned at each point (x,y,z) in the density map and the
overlap volume calculated (i.e., a type of convolution).  This tip
position corresponds to a zero displacement.  The correct tip position
is found by shifting the tip upwards (in the z-direction) until the 
displacement and elastic forces are approximately equal.  The tip 
displacement is refined by interpolation and the force calculated.  
The force map is returned in place of the original density map.
Forces are calculated in piconewton. 
The origin of the tip density is taken as nx/2, ny/2, 0.</pre> </dd></dl>

<p>Definition at line <a class="el" href="img__afm_8cpp_source.html#l00311">311</a> of file <a class="el" href="img__afm_8cpp_source.html">img_afm.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a13429ae13d7e4510f96ed2bbe97aca5a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_bimage.html">Bimage</a>* img_3D_to_height </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>threshold</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Converts a 3D image to a 2D height image. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*p</td><td>3D image. </td></tr>
    <tr><td class="paramname">threshold</td><td>threshold to define the surface (assuming positive density). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Bimage* 2D height image. <pre class="fragment">The threshold defines the surface of the positive density in the 3D image.
Each line of voxels in the z-direction is scanned for the voxel
exceeding the threshold with the highest z-index.</pre> </dd></dl>

<p>Definition at line <a class="el" href="img__afm_8cpp_source.html#l00123">123</a> of file <a class="el" href="img__afm_8cpp_source.html">img_afm.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a97ff964041dc379d234451976b2e81af"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int img_to_surface </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>psd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>density</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>resolution</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Converts a 2D AFM image to a 3D density map. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*p</td><td>2D AFM image. </td></tr>
    <tr><td class="paramname">*psd</td><td>2D standard deviation image. </td></tr>
    <tr><td class="paramname">nz</td><td>z dimension of the new 3D map. </td></tr>
    <tr><td class="paramname">density</td><td>density inside the surface (Da/A3). </td></tr>
    <tr><td class="paramname">resolution</td><td>sigma bounds. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int 0. <pre class="fragment">The 2D image is expanded in the z direction according to:
                          voxel_density
dens[x,y,z] = --------------------------------------
              1+exp(factor*(z-zdis[x,y])/sigma[x,y])
where   voxel_density is the total density attributed to a voxel
        factor = 1.618
        z - zdis[x,y] is the z distance from the surface
        sigma is a standard deviation term to describe the surface variability.
The sigma term can be set automatically or given by an input standard deviation map.
The position of the surface is calculated as:
zdis[x,y] = loz + (hiz - loz)*(image[x,y] - min)/(max - min)
where   loz and hiz are the lowest and highest points of the surface in the 3D map
        min and max are the image minimum and maximum values</pre> </dd></dl>

<p>Definition at line <a class="el" href="img__afm_8cpp_source.html#l00040">40</a> of file <a class="el" href="img__afm_8cpp_source.html">img_afm.cpp</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="img__afm_8h.html">img_afm.h</a></li>
    <li class="footer">Generated on Wed Jun 1 2016 17:39:22 for Bsoft by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.8 </li>
  </ul>
</div>
</body>
</html>
