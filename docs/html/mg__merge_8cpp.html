<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bsoft: /Users/heymannb/b20/bsoft/src/mg/mg_merge.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Bsoft_icon128.jpg"/></td>
  <td id="projectalign">
   <div id="projectname">Bsoft<span id="projectnumber">&#160;2.1.4</span>
   </div>
   <div id="projectbrief">Bernard&#39;s software package</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('mg__merge_8cpp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">mg_merge.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Library functions to merge images.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="mg__merge_8h.html">mg_merge.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mg__select_8h.html">mg_select.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="utilities_8h.html">utilities.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a04dec7d8139be8284c5e87653ee6fce1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mg__merge_8cpp.html#a04dec7d8139be8284c5e87653ee6fce1">img_unique_shift_global_rotate</a> (<a class="el" href="class_bimage.html">Bimage</a> *p, <a class="el" href="class_vector3.html">Vector3</a>&lt; float &gt; *origin, <a class="el" href="class_vector3.html">Vector3</a>&lt; float &gt; *shift, float <a class="el" href="_vector3_8h.html#ae39c57d147eeec4507b1687fed37f53e">angle</a>)</td></tr>
<tr class="memdesc:a04dec7d8139be8284c5e87653ee6fce1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Shifts and rotates each image as defined in individual shift vectors.  <a href="mg__merge_8cpp.html#a04dec7d8139be8284c5e87653ee6fce1">More...</a><br /></td></tr>
<tr class="separator:a04dec7d8139be8284c5e87653ee6fce1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a960b8a71887aed5cb5da3fd2f6734184"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mg__merge_8cpp.html#a960b8a71887aed5cb5da3fd2f6734184">mg_particle_merge_series</a> (<a class="el" href="class_bproject.html">Bproject</a> *<a class="el" href="tcltk__bmodel_8cpp.html#aea438e09dfc03683a0f49a05e9a69cac">project</a>, int mg_ref_select, int mg_index, float mg_rot_ang, int mg_ori_select, <a class="el" href="class_bstring.html">Bstring</a> outimg)</td></tr>
<tr class="memdesc:a960b8a71887aed5cb5da3fd2f6734184"><td class="mdescLeft">&#160;</td><td class="mdescRight">Aligns and merges (sums) 2D particle images from a focal, or other, series and writes to new image file(s).  <a href="mg__merge_8cpp.html#a960b8a71887aed5cb5da3fd2f6734184">More...</a><br /></td></tr>
<tr class="separator:a960b8a71887aed5cb5da3fd2f6734184"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa44b120ddd8afdaba9f4fbb15792b1da"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mg__merge_8cpp.html#aa44b120ddd8afdaba9f4fbb15792b1da">mg_particle_unmerge</a> (<a class="el" href="class_bproject.html">Bproject</a> *<a class="el" href="tcltk__bmodel_8cpp.html#aea438e09dfc03683a0f49a05e9a69cac">project</a>, <a class="el" href="class_bproject.html">Bproject</a> *orientations, float fom_diff)</td></tr>
<tr class="memdesc:aa44b120ddd8afdaba9f4fbb15792b1da"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gives corresponding particles in a field-of-view the same orientation, figure-of-merit (FOM), and selection&ndash;allows selection of best orientation based on best FOM.  <a href="mg__merge_8cpp.html#aa44b120ddd8afdaba9f4fbb15792b1da">More...</a><br /></td></tr>
<tr class="separator:aa44b120ddd8afdaba9f4fbb15792b1da"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a0b2caeb4b6f130be43e5a2f0267dd453"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mg__merge_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a></td></tr>
<tr class="separator:a0b2caeb4b6f130be43e5a2f0267dd453"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Library functions to merge images. </p>
<dl class="section author"><dt>Author</dt><dd>David Belnap and Bernard Heymann </dd></dl>
<dl class="section date"><dt>Date</dt><dd>Created: 20030410 </dd>
<dd>
Modified: 20150805(BH) </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a04dec7d8139be8284c5e87653ee6fce1" name="a04dec7d8139be8284c5e87653ee6fce1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a04dec7d8139be8284c5e87653ee6fce1">&#9670;&nbsp;</a></span>img_unique_shift_global_rotate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int img_unique_shift_global_rotate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_vector3.html">Vector3</a>&lt; float &gt; *&#160;</td>
          <td class="paramname"><em>origin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_vector3.html">Vector3</a>&lt; float &gt; *&#160;</td>
          <td class="paramname"><em>shift</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>angle</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Shifts and rotates each image as defined in individual shift vectors. </p>
<dl class="section author"><dt>Author</dt><dd>Bernard Heymann and David Belnap </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*p</td><td>image(s) to be rotated and shifted (converted to floating point). </td></tr>
    <tr><td class="paramname">*origin</td><td>array of 3-value origin vectors, one for each image. </td></tr>
    <tr><td class="paramname">*shift</td><td>array of 3-value shift vectors, one for each image. </td></tr>
    <tr><td class="paramname">angle</td><td>global rotation angle to apply to all images. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int number of images. <pre class="fragment">Each image in a Bimage structure is shifted by an unique amount but 
rotated by the same angle, no scaling or resizing is done.
Intended for use in merging single particle images from a focal, or
other, series of particles from micrographs.
</pre> </dd></dl>

</div>
</div>
<a id="a960b8a71887aed5cb5da3fd2f6734184" name="a960b8a71887aed5cb5da3fd2f6734184"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a960b8a71887aed5cb5da3fd2f6734184">&#9670;&nbsp;</a></span>mg_particle_merge_series()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mg_particle_merge_series </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bproject.html">Bproject</a> *&#160;</td>
          <td class="paramname"><em>project</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mg_ref_select</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mg_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>mg_rot_ang</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mg_ori_select</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_bstring.html">Bstring</a>&#160;</td>
          <td class="paramname"><em>outimg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Aligns and merges (sums) 2D particle images from a focal, or other, series and writes to new image file(s). </p>
<dl class="section author"><dt>Author</dt><dd>David Belnap and Bernard Heymann</dd></dl>
<p>Find the reference micrograph based on the input criterion. Read the reference particle images first, followed by the non-reference images. Find shifts and origins, shift each non-reference image to align the two origins and rotate by the difference in in-plane rotational angle (if any) of the two micrographs. Return the normalized sum of images. Images are converted to floating point.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*project</td><td>Project parameter structure </td></tr>
    <tr><td class="paramname">mg_ref_select</td><td>0, closest-to-focus; 1, furthest-from-focus; 2, by index; 3, by rotation angle </td></tr>
    <tr><td class="paramname">mg_index</td><td>Reference by its index in field (for mg_ref_select=2) </td></tr>
    <tr><td class="paramname">mg_rot_ang</td><td>Reference by micrograph rotation angle (for mg_ref_select=3) </td></tr>
    <tr><td class="paramname">mg_ori_select</td><td>0, from parameter file; 1, from cross-correlation; 2, from images; -1, no alignment </td></tr>
    <tr><td class="paramname">outimg</td><td>prefix and extension for output files </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int error code. </dd></dl>

</div>
</div>
<a id="aa44b120ddd8afdaba9f4fbb15792b1da" name="aa44b120ddd8afdaba9f4fbb15792b1da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa44b120ddd8afdaba9f4fbb15792b1da">&#9670;&nbsp;</a></span>mg_particle_unmerge()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mg_particle_unmerge </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bproject.html">Bproject</a> *&#160;</td>
          <td class="paramname"><em>project</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_bproject.html">Bproject</a> *&#160;</td>
          <td class="paramname"><em>orientations</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>fom_diff</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Gives corresponding particles in a field-of-view the same orientation, figure-of-merit (FOM), and selection&ndash;allows selection of best orientation based on best FOM. </p>
<dl class="section author"><dt>Author</dt><dd>David Belnap </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*project</td><td>Project structure for micrographs </td></tr>
    <tr><td class="paramname">*orientations</td><td>Project structure containing orientations to use </td></tr>
    <tr><td class="paramname">fom_diff</td><td>Threshold for difference between FOMs </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int error code. <pre class="fragment">Intended for use in un-merging data from a micrograph series, where 
the particle images had been merged previously and there is only one
set of parameters per field.
  Set orientations, FOMs, and selection for corresponding particles 
in a field-of-view to that found in the project structure named 
orientations.  If user wishes to select the orientation and
selection value with the highest FOM, the highest FOM (within the
specified threshold) is selected.
  Differences in micrograph rotation angles (with respect to the
"reference" micrograph that contains the orientations to be applied)
are applied to the output orientation.
</pre> </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a0b2caeb4b6f130be43e5a2f0267dd453" name="a0b2caeb4b6f130be43e5a2f0267dd453"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b2caeb4b6f130be43e5a2f0267dd453">&#9670;&nbsp;</a></span>verbose</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int verbose</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_1d197ef0d9947f4cc1ac44e7f59e2b57.html">mg</a></li><li class="navelem"><a class="el" href="mg__merge_8cpp.html">mg_merge.cpp</a></li>
    <li class="footer">Generated on Tue Jan 31 2023 08:21:29 for Bsoft by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
