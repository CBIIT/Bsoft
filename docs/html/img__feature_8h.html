<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>Bsoft: /usr/local/bsoft/include/img_feature.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Bsoft_icon128.jpg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Bsoft
   &#160;<span id="projectnumber">1.9</span>
   </div>
   <div id="projectbrief">Bernard&#39;s software package</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('img__feature_8h.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">img_feature.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Header file for feature extraction tools.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &quot;<a class="el" href="marker_8h_source.html">marker.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="rwimg_8h_source.html">rwimg.h</a>&quot;</code><br />
</div>
<p><a href="img__feature_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab76bfb30f8b2ad5b1e7483a2d4a7c04f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="img__feature_8h.html#ab76bfb30f8b2ad5b1e7483a2d4a7c04f">img_replace_maxima</a> (<a class="el" href="class_bimage.html">Bimage</a> *p, float threshold)</td></tr>
<tr class="memdesc:ab76bfb30f8b2ad5b1e7483a2d4a7c04f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Replaces maxima above a threshold using local averages.  <a href="#ab76bfb30f8b2ad5b1e7483a2d4a7c04f">More...</a><br /></td></tr>
<tr class="separator:ab76bfb30f8b2ad5b1e7483a2d4a7c04f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08d594aae23a646efc9ddcabd950d614"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_bmarker.html">Bmarker</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="img__feature_8h.html#a08d594aae23a646efc9ddcabd950d614">img_extract_features</a> (<a class="el" href="class_bimage.html">Bimage</a> *p, int extract_method, int target_num, float threshold)</td></tr>
<tr class="memdesc:a08d594aae23a646efc9ddcabd950d614"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finds local minimums in a grey scale image and uses those as features.  <a href="#a08d594aae23a646efc9ddcabd950d614">More...</a><br /></td></tr>
<tr class="separator:a08d594aae23a646efc9ddcabd950d614"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae1e19e593402376a442278e8c7fd23e0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="img__feature_8h.html#ae1e19e593402376a442278e8c7fd23e0">img_find_features</a> (<a class="el" href="class_bimage.html">Bimage</a> *p, float threshold, int sign, int wrap)</td></tr>
<tr class="memdesc:ae1e19e593402376a442278e8c7fd23e0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Segments an image into contiguous regions (features).  <a href="#ae1e19e593402376a442278e8c7fd23e0">More...</a><br /></td></tr>
<tr class="separator:ae1e19e593402376a442278e8c7fd23e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66c7f950ee875aead7dbb2fbbbe16fab"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="img__feature_8h.html#a66c7f950ee875aead7dbb2fbbbe16fab">img_average_feature_size</a> (<a class="el" href="class_bimage.html">Bimage</a> *p)</td></tr>
<tr class="memdesc:a66c7f950ee875aead7dbb2fbbbe16fab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the average size of regions (features) in a level mask.  <a href="#a66c7f950ee875aead7dbb2fbbbe16fab">More...</a><br /></td></tr>
<tr class="separator:a66c7f950ee875aead7dbb2fbbbe16fab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aefb048d9ef0f49211299338d36237443"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="img__feature_8h.html#aefb048d9ef0f49211299338d36237443">img_assignAllMyNeighbors</a> (<a class="el" href="class_bimage.html">Bimage</a> *p, int *feature_mask, unsigned long index, int feature_number, float threshold, int sign, int wrap)</td></tr>
<tr class="memdesc:aefb048d9ef0f49211299338d36237443"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finds all the pixels that are part of the same feature.  <a href="#aefb048d9ef0f49211299338d36237443">More...</a><br /></td></tr>
<tr class="separator:aefb048d9ef0f49211299338d36237443"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Header file for feature extraction tools. </p>
<dl class="section author"><dt>Author</dt><dd>Samuel Payne and Bernard Heymann </dd></dl>
<dl class="section date"><dt>Date</dt><dd>Created: 20010516 Modified: 20121016 (BH) </dd></dl>

<p>Definition in file <a class="el" href="img__feature_8h_source.html">img_feature.h</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="aefb048d9ef0f49211299338d36237443"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int img_assignAllMyNeighbors </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>feature_mask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>feature_number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>threshold</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sign</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>wrap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Finds all the pixels that are part of the same feature. </p>
<dl class="section author"><dt>Author</dt><dd>Samuel Payne and Bernard Heymann </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*p</td><td>the image. </td></tr>
    <tr><td class="paramname">*feature_mask</td><td>a mask holding feature assignments. </td></tr>
    <tr><td class="paramname">index</td><td>the first voxel of a feature. </td></tr>
    <tr><td class="paramname">feature_number</td><td>the feature number that voxels are assigned. </td></tr>
    <tr><td class="paramname">threshold</td><td>the level at which things are ignored. </td></tr>
    <tr><td class="paramname">sign</td><td>sign controlling direction of thresholding. </td></tr>
    <tr><td class="paramname">wrap</td><td>flag to wrap around image boundaries. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int 0. <pre class="fragment">This method uses a list to keep track of voxels assigned to a feature.
In subsequent iterations the non-assigned voxels next to those in
the list are assigned if they exceed the threshold, and their indices
are kept in a new list. The new list is transferred to the old list
and the process iteratively continued until the new list contains
no more voxels.</pre> </dd></dl>

<p>Definition at line <a class="el" href="img__feature_8cpp_source.html#l00543">543</a> of file <a class="el" href="img__feature_8cpp_source.html">img_feature.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a66c7f950ee875aead7dbb2fbbbe16fab"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double img_average_feature_size </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the average size of regions (features) in a level mask. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*p</td><td>the image. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>double average feature size. </dd></dl>

<p>Definition at line <a class="el" href="img__feature_8cpp_source.html#l00455">455</a> of file <a class="el" href="img__feature_8cpp_source.html">img_feature.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a08d594aae23a646efc9ddcabd950d614"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_bmarker.html">Bmarker</a>* img_extract_features </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>extract_method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>target_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>threshold</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Finds local minimums in a grey scale image and uses those as features. </p>
<dl class="section author"><dt>Author</dt><dd>Samuel Payne and Bernard Heymann </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*p</td><td>image (modified to floating point). </td></tr>
    <tr><td class="paramname">extract_method</td><td>The method to determine the center of the particle </td></tr>
    <tr><td class="paramname">target_num</td><td>Max number of desired features (-1 will return all) </td></tr>
    <tr><td class="paramname">threshold</td><td>Threshold value used to determine whether a pixel is considered a feature. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Bmarker* a set containing xyz coordinates of features <pre class="fragment">The input image is expected to have been cleaned in the following manner.
With each suggestion is listed the corresponding bsoft function call. 
1.  Any extremes such as white lettering, or black edges have been removed.
    bfilter -e filname filename
2. Edge filter to smooth out the edges.
    bedge -x&lt;xsize&gt;,&lt;ysize&gt;,&lt;zsize&gt; -o150,150,0 -g75 filename filename
3. Bandpass filtered to reduce the noise.  
    bfilter -b1000,2000 -df filename filename

The algorithm finds blocks of dark grey. The features are black dots 
in the image, which could be particles, but don't have to be.  As long 
as the picking is consistent, it does not matter what is picked.  
(it could be a pickle).  The method used to find the center of the feature 
depends on the input. (0=Center of Mass, 1=Center of Area, 2=Darkest pixel)</pre> </dd></dl>

<p>Definition at line <a class="el" href="img__feature_8cpp_source.html#l00249">249</a> of file <a class="el" href="img__feature_8cpp_source.html">img_feature.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ae1e19e593402376a442278e8c7fd23e0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_bimage.html">Bimage</a>* img_find_features </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>threshold</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sign</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>wrap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Segments an image into contiguous regions (features). </p>
<p>The image is segmented into contiguous regions where a region is defined as all those voxels exceeding the given threshold and adjacent to each other. This method uses a list to keep track of voxels assigned to a feature. In subsequent iterations the non-assigned voxels next to those in the list are assigned if they exceed the threshold, and their indices are kept in a new list. The new list is transferred to the old list and the process iteratively continued until the new list contains no more voxels. The indices of all the features are packed into an integer data block within a new image. The new image maps the indices of the features starting from one to as many features as were found (the maximum gives the number of features). The new image has zeroes for all voxels outside the features.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*p</td><td>the image. </td></tr>
    <tr><td class="paramname">threshold</td><td>the level at which things are ignored. </td></tr>
    <tr><td class="paramname">sign</td><td>sign controlling direction of thresholding. </td></tr>
    <tr><td class="paramname">wrap</td><td>flag to wrap around image boundaries. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Bimage* integer image containing feature index numbers. </dd></dl>

<p>Definition at line <a class="el" href="img__feature_8cpp_source.html#l00407">407</a> of file <a class="el" href="img__feature_8cpp_source.html">img_feature.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ab76bfb30f8b2ad5b1e7483a2d4a7c04f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int img_replace_maxima </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>threshold</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Replaces maxima above a threshold using local averages. </p>
<p>The image is first segemented into features, each defined as a contiguous cluster of voxels with values above the threshold. Each feature is encoded in an integer image, with all the values in this image set to the indices of the features, or zero elsewhere. The features are iteratively filled in, where in every iteration, the border values of the features are replaced by the average of the neighbouring voxels outside the feature. After each iteration, every feature is shrunk by excluding the newly replaced voxels.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*p</td><td>image (modified to floating point). </td></tr>
    <tr><td class="paramname">threshold</td><td>threshold. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int 0. </dd></dl>

<p>Definition at line <a class="el" href="img__feature_8cpp_source.html#l00039">39</a> of file <a class="el" href="img__feature_8cpp_source.html">img_feature.cpp</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="img__feature_8h.html">img_feature.h</a></li>
    <li class="footer">Generated on Fri Aug 14 2015 18:20:05 for Bsoft by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.8 </li>
  </ul>
</div>
</body>
</html>
