<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bsoft: /Users/heymannb/b20/bsoft/include/mg_subtomo.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Bsoft_icon128.jpg"/></td>
  <td id="projectalign">
   <div id="projectname">Bsoft<span id="projectnumber">&#160;2.1.4</span>
   </div>
   <div id="projectbrief">Bernard&#39;s software package</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('mg__subtomo_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">mg_subtomo.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Header file for functions finding particles (subtomograms) in a tomogram.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="rwimg_8h.html">rwimg.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_view_8h.html">View.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="symmetry_8h.html">symmetry.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mg__processing_8h.html">mg_processing.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_sphere.html">Sphere</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a166ec7a4246c114763304fbc7a9aaa8f"><td class="memItemLeft" align="right" valign="top">long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mg__subtomo_8h.html#a166ec7a4246c114763304fbc7a9aaa8f">reconstruction_search_subtomo</a> (<a class="el" href="class_breconstruction.html">Breconstruction</a> *rec, <a class="el" href="class_bimage.html">Bimage</a> *p, <a class="el" href="class_bimage.html">Bimage</a> *ptemp, <a class="el" href="class_bimage.html">Bimage</a> *pmask, <a class="el" href="class_bimage.html">Bimage</a> *pmask2, double alpha_step, double theta_step, double phi_step, double alpha_limit, double thetaphi_limit, double hires, double lores, double shiftlimit, double mindist, double threshold, int maxhits, <a class="el" href="class_vector3.html">Vector3</a>&lt; long &gt; bin, <a class="el" href="struct_bsymmetry.html">Bsymmetry</a> &amp;sym, int refinepeaks, <a class="el" href="class_bstring.html">Bstring</a> ccmax_file)</td></tr>
<tr class="separator:a166ec7a4246c114763304fbc7a9aaa8f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed94993d70e9438aae0febe97e12cd57"><td class="memItemLeft" align="right" valign="top">long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mg__subtomo_8h.html#aed94993d70e9438aae0febe97e12cd57">reconstruction_refine_subtomo</a> (<a class="el" href="class_breconstruction.html">Breconstruction</a> *rec, <a class="el" href="class_bimage.html">Bimage</a> *p, <a class="el" href="class_bimage.html">Bimage</a> *ptemp, <a class="el" href="class_bimage.html">Bimage</a> *pmask, <a class="el" href="class_bimage.html">Bimage</a> *pmask2, double alpha_step, double theta_step, double phi_step, double alpha_limit, double thetaphi_limit, double hires, double lores, double shiftlimit, double shiftlimitz, double shiftlimitxy, double mindist, <a class="el" href="class_vector3.html">Vector3</a>&lt; long &gt; bin, <a class="el" href="struct_bsymmetry.html">Bsymmetry</a> &amp;sym, int iters, int refinepeaks, <a class="el" href="class_bstring.html">Bstring</a> ccmax_file)</td></tr>
<tr class="memdesc:aed94993d70e9438aae0febe97e12cd57"><td class="mdescLeft">&#160;</td><td class="mdescRight">Refines the view vectors for particles already in the project.  <a href="mg__subtomo_8h.html#aed94993d70e9438aae0febe97e12cd57">More...</a><br /></td></tr>
<tr class="separator:aed94993d70e9438aae0febe97e12cd57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac1b52fe53c010ff5360444c24a03bcd3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_bparticle.html">Bparticle</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mg__subtomo_8h.html#ac1b52fe53c010ff5360444c24a03bcd3">img_find_refine_peaks</a> (<a class="el" href="class_bimage.html">Bimage</a> *pcc, <a class="el" href="class_view.html">View</a> view, double shift_limit, double shift_along, double shift_orthogonal, double mindist, double threshold, int maxhits, int refinepeaks)</td></tr>
<tr class="memdesc:ac1b52fe53c010ff5360444c24a03bcd3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finds peaks in an image to the nearest voxel iteratively.  <a href="mg__subtomo_8h.html#ac1b52fe53c010ff5360444c24a03bcd3">More...</a><br /></td></tr>
<tr class="separator:ac1b52fe53c010ff5360444c24a03bcd3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30c445b08d271edce06ae0917341c1cb"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mg__subtomo_8h.html#a30c445b08d271edce06ae0917341c1cb">img_find_peak_subtomo</a> (<a class="el" href="class_bimage.html">Bimage</a> *p, <a class="el" href="class_view.html">View</a> view, double shift, double shift_along, double shift_orthogonal)</td></tr>
<tr class="memdesc:a30c445b08d271edce06ae0917341c1cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finds the peak in an image to the nearest voxel.  <a href="mg__subtomo_8h.html#a30c445b08d271edce06ae0917341c1cb">More...</a><br /></td></tr>
<tr class="separator:a30c445b08d271edce06ae0917341c1cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab86720ef3a4b5af9b7d3e4d6e9d11f14"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_vector3.html">Vector3</a>&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mg__subtomo_8h.html#ab86720ef3a4b5af9b7d3e4d6e9d11f14">closest_point_line</a> (<a class="el" href="class_vector3.html">Vector3</a>&lt; double &gt; point, <a class="el" href="class_vector3.html">Vector3</a>&lt; double &gt; endpoint1, <a class="el" href="class_vector3.html">Vector3</a>&lt; double &gt; endpoint2)</td></tr>
<tr class="memdesc:ab86720ef3a4b5af9b7d3e4d6e9d11f14"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the closest point on a line segment from a given point.  <a href="mg__subtomo_8h.html#ab86720ef3a4b5af9b7d3e4d6e9d11f14">More...</a><br /></td></tr>
<tr class="separator:ab86720ef3a4b5af9b7d3e4d6e9d11f14"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d2c59fdce157c283a626b59776a09d8"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mg__subtomo_8h.html#a9d2c59fdce157c283a626b59776a09d8">closest_point_line_distance2</a> (<a class="el" href="class_vector3.html">Vector3</a>&lt; double &gt; point, <a class="el" href="class_vector3.html">Vector3</a>&lt; double &gt; endpoint1, <a class="el" href="class_vector3.html">Vector3</a>&lt; double &gt; endpoint2)</td></tr>
<tr class="memdesc:a9d2c59fdce157c283a626b59776a09d8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the squared distance to the closest point on a line segment from a given point.  <a href="mg__subtomo_8h.html#a9d2c59fdce157c283a626b59776a09d8">More...</a><br /></td></tr>
<tr class="separator:a9d2c59fdce157c283a626b59776a09d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54d09d9aec17bfdb98dbd5649fae0902"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mg__subtomo_8h.html#a54d09d9aec17bfdb98dbd5649fae0902">closest_point_disc_distance2</a> (<a class="el" href="class_vector3.html">Vector3</a>&lt; double &gt; point, <a class="el" href="class_vector3.html">Vector3</a>&lt; double &gt; point2, <a class="el" href="class_view.html">View</a> view, double radius)</td></tr>
<tr class="memdesc:a54d09d9aec17bfdb98dbd5649fae0902"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the squared distance to the closest point on a disc from a given point.  <a href="mg__subtomo_8h.html#a54d09d9aec17bfdb98dbd5649fae0902">More...</a><br /></td></tr>
<tr class="separator:a54d09d9aec17bfdb98dbd5649fae0902"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f6e1dc4bc4c5883e48f83aa5d65ee44"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_sphere.html">Sphere</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mg__subtomo_8h.html#a5f6e1dc4bc4c5883e48f83aa5d65ee44">locations_fit_sphere</a> (<a class="el" href="class_bparticle.html">Bparticle</a> *part, int N, double Nstop)</td></tr>
<tr class="memdesc:a5f6e1dc4bc4c5883e48f83aa5d65ee44"><td class="mdescLeft">&#160;</td><td class="mdescRight">Least squares fit a sphere to 3D data (particle locations)  <a href="mg__subtomo_8h.html#a5f6e1dc4bc4c5883e48f83aa5d65ee44">More...</a><br /></td></tr>
<tr class="separator:a5f6e1dc4bc4c5883e48f83aa5d65ee44"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Header file for functions finding particles (subtomograms) in a tomogram. </p>
<dl class="section author"><dt>Author</dt><dd>Juha Huiskonen </dd>
<dd>
Bernard Heymann </dd></dl>
<dl class="section date"><dt>Date</dt><dd>Created: 20071010 </dd>
<dd>
Modified: 20120124 (BH) </dd>
<dd>
Modified: 20150108 (BH) - incorporated into Bsoft </dd>
<dd>
Modified: 20150720 (BH) </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a54d09d9aec17bfdb98dbd5649fae0902" name="a54d09d9aec17bfdb98dbd5649fae0902"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54d09d9aec17bfdb98dbd5649fae0902">&#9670;&nbsp;</a></span>closest_point_disc_distance2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double closest_point_disc_distance2 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_vector3.html">Vector3</a>&lt; double &gt;&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_vector3.html">Vector3</a>&lt; double &gt;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_view.html">View</a>&#160;</td>
          <td class="paramname"><em>view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>radius</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the squared distance to the closest point on a disc from a given point. </p>
<dl class="section author"><dt>Author</dt><dd>Juha Huiskonen </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p</td><td>point </td></tr>
    <tr><td class="paramname">q</td><td>centre point of the disc </td></tr>
    <tr><td class="paramname">view</td><td></td></tr>
    <tr><td class="paramname">radius</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>double squared distance to closest point <pre class="fragment">Checks whether projection of the point (p') falls on the disc. If yes, this is the closest point
Otherwise point on the circumference of the disc is the closest point.
</pre> </dd></dl>

</div>
</div>
<a id="ab86720ef3a4b5af9b7d3e4d6e9d11f14" name="ab86720ef3a4b5af9b7d3e4d6e9d11f14"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab86720ef3a4b5af9b7d3e4d6e9d11f14">&#9670;&nbsp;</a></span>closest_point_line()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_vector3.html">Vector3</a>&lt; double &gt; closest_point_line </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_vector3.html">Vector3</a>&lt; double &gt;&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_vector3.html">Vector3</a>&lt; double &gt;&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_vector3.html">Vector3</a>&lt; double &gt;&#160;</td>
          <td class="paramname"><em>w</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the closest point on a line segment from a given point. </p>
<dl class="section author"><dt>Author</dt><dd>Juha Huiskonen </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p</td><td>point </td></tr>
    <tr><td class="paramname">v</td><td>endpoint 1 </td></tr>
    <tr><td class="paramname">w</td><td>endpoint 2 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="class_vector3.html">Vector3&lt;double&gt;</a> closest point <pre class="fragment">Checks whether one of the end points is the closest point
</pre> </dd></dl>

</div>
</div>
<a id="a9d2c59fdce157c283a626b59776a09d8" name="a9d2c59fdce157c283a626b59776a09d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d2c59fdce157c283a626b59776a09d8">&#9670;&nbsp;</a></span>closest_point_line_distance2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double closest_point_line_distance2 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_vector3.html">Vector3</a>&lt; double &gt;&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_vector3.html">Vector3</a>&lt; double &gt;&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_vector3.html">Vector3</a>&lt; double &gt;&#160;</td>
          <td class="paramname"><em>w</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the squared distance to the closest point on a line segment from a given point. </p>
<dl class="section author"><dt>Author</dt><dd>Juha Huiskonen </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p</td><td>point </td></tr>
    <tr><td class="paramname">v</td><td>endpoint 1 </td></tr>
    <tr><td class="paramname">w</td><td>endpoint 2 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>double squared distance to the closest point <pre class="fragment">Checks wether the closet point falls within the line segment. If not, one of the endpoints
is the closest point.
</pre> </dd></dl>

</div>
</div>
<a id="a30c445b08d271edce06ae0917341c1cb" name="a30c445b08d271edce06ae0917341c1cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a30c445b08d271edce06ae0917341c1cb">&#9670;&nbsp;</a></span>img_find_peak_subtomo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double img_find_peak_subtomo </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_view.html">View</a>&#160;</td>
          <td class="paramname"><em>view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>shift</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>shift_along</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>shift_orthogonal</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Finds the peak in an image to the nearest voxel. </p>
<dl class="section author"><dt>Author</dt><dd>Juha Huiskonen </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*p</td><td>image (not altered). </td></tr>
    <tr><td class="paramname">view</td><td>view of the particle to be refined </td></tr>
    <tr><td class="paramname">shift</td><td>radius of spherical or cylindrical search space (if &lt; 0, default 1e30). </td></tr>
    <tr><td class="paramname">shift_along</td><td>additional shift allowed in the direction of the view vector. </td></tr>
    <tr><td class="paramname">shift_orthogonal</td><td>additional shift allowed orthogonal to the view vector. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>double peak maximum. <pre class="fragment">An image is searched for the global maximum (typically used to find the shift vector in a cross-correlation map).
The peak vector is returned in the image origin in actual pixel coordinates (no wrapping).
The maximum is returned in the image FOM.
</pre> </dd></dl>

</div>
</div>
<a id="ac1b52fe53c010ff5360444c24a03bcd3" name="ac1b52fe53c010ff5360444c24a03bcd3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac1b52fe53c010ff5360444c24a03bcd3">&#9670;&nbsp;</a></span>img_find_refine_peaks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_bparticle.html">Bparticle</a> * img_find_refine_peaks </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>pcc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_view.html">View</a>&#160;</td>
          <td class="paramname"><em>view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>shift_limit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>shift_along</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>shift_orthogonal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>mindist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>threshold</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxhits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>refinepeaks</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Finds peaks in an image to the nearest voxel iteratively. </p>
<dl class="section author"><dt>Author</dt><dd>Juha Huiskonen </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*pcc</td><td>cross correlation map (not altered). </td></tr>
    <tr><td class="paramname">view</td><td>view of the particle to be refined </td></tr>
    <tr><td class="paramname">shift_limit</td><td>radius of spherical or cylindrical search space (if &lt; 0, default 1e30). </td></tr>
    <tr><td class="paramname">shift_along</td><td>additional shift allowed in the direction of the view vector. </td></tr>
    <tr><td class="paramname">shift_orthogonal</td><td>additional shift allowed orthogonal to the view vector. </td></tr>
    <tr><td class="paramname">mindist</td><td>2 * template radius: used for a spherical mask </td></tr>
    <tr><td class="paramname">threshold</td><td>threshold. if value is &lt;0, only the global maximum is returned </td></tr>
    <tr><td class="paramname">maxhits</td><td></td></tr>
    <tr><td class="paramname">refinepeaks</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Bparticle* list of peaks as particles. <pre class="fragment">After a maximum value is found, it is masked with a spherical mask and the next largest value
is found, until all the values are below the threshold .
</pre> </dd></dl>

</div>
</div>
<a id="a5f6e1dc4bc4c5883e48f83aa5d65ee44" name="a5f6e1dc4bc4c5883e48f83aa5d65ee44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f6e1dc4bc4c5883e48f83aa5d65ee44">&#9670;&nbsp;</a></span>locations_fit_sphere()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_sphere.html">Sphere</a> locations_fit_sphere </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bparticle.html">Bparticle</a> *&#160;</td>
          <td class="paramname"><em>part</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>N</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>Nstop</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Least squares fit a sphere to 3D data (particle locations) </p>
<dl class="section author"><dt>Author</dt><dd>Juha Huiskonen </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*part</td><td>particle </td></tr>
    <tr><td class="paramname">N</td><td>iterations </td></tr>
    <tr><td class="paramname">Nstop</td><td>stopping condition: tolerance in change of sphere center </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="struct_sphere.html">Sphere</a> fitted sphere struct <pre class="fragment">Algorithm by ImaginaryZ
From http://imaginaryz.blogspot.co.uk/2011/04/least-squares-fit-sphere-to-3d-data.html

All you have to do is define:

Error = Sum( |Position[n] - Center|^2 - Radius^2 )

Then define the squared error:

Squared Error = Sum( ( |Position[n] - Center|^2 - Radius^2 )^2 )

And solve the summation using a iterative method (like newtons, below) after pulling out the summation terms.
For example, if you do: Sum( (P.x[n] - Cx)^2 ) You get (after Expand):
Sum( P.x[n]^2 - 2*P.x[n]*Cx + Cx^2 )
And you can then split up the sum:
Sum( P.x[n]^2 ) + Sum( P.x[n] ) * -2*Cx + Cx * Nelements
Note you HAVE to ultimately divide the sums by Nelements

Note that "Center" is A,B,C (3D) and I use Rsq as Radius^2.

This method is not fast, but it converges, and the way the code is written it is independent of dataset size,
but you do have to compute a number of sums and products before running the algorithm.

Note this method is used to generate the equations used to compute linear and quadratic fits instantly, given you compute some sums first.
</pre> </dd></dl>

</div>
</div>
<a id="aed94993d70e9438aae0febe97e12cd57" name="aed94993d70e9438aae0febe97e12cd57"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed94993d70e9438aae0febe97e12cd57">&#9670;&nbsp;</a></span>reconstruction_refine_subtomo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">long reconstruction_refine_subtomo </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_breconstruction.html">Breconstruction</a> *&#160;</td>
          <td class="paramname"><em>rec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>ptemp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>pmask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>pmask2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>alpha_step_orig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>theta_step_orig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>phi_step_orig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>alpha_limit_orig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>thetaphi_limit_orig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>hires</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>lores</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>shiftlimit_orig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>shiftlimitz_orig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>shiftlimitxy_orig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>mindist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_vector3.html">Vector3</a>&lt; long &gt;&#160;</td>
          <td class="paramname"><em>bin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_bsymmetry.html">Bsymmetry</a> &amp;&#160;</td>
          <td class="paramname"><em>sym</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>iters</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>refinepeaks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_bstring.html">Bstring</a>&#160;</td>
          <td class="paramname"><em>ccmax_file</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Refines the view vectors for particles already in the project. </p>
<dl class="section author"><dt>Author</dt><dd>Juha Huiskonen </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*rec</td><td>reconstruction parameters. </td></tr>
    <tr><td class="paramname">*p</td><td>the image. </td></tr>
    <tr><td class="paramname">*ptemp</td><td>the template to be searched for. </td></tr>
    <tr><td class="paramname">*pmask</td><td>reciprocal space mask for cross-correlation (ignored if NULL). </td></tr>
    <tr><td class="paramname">*pmask2</td><td>real space mask for cross-correlation (ignored if NULL). </td></tr>
    <tr><td class="paramname">alpha_step_orig</td><td>angular step size around view vector (radians). </td></tr>
    <tr><td class="paramname">theta_step_orig</td><td>angular step size around view vector (radians). </td></tr>
    <tr><td class="paramname">phi_step_orig</td><td>angular step size around view vector (radians). </td></tr>
    <tr><td class="paramname">alpha_limit_orig</td><td>angular limit for refinement in alpha (radians). </td></tr>
    <tr><td class="paramname">thetaphi_limit_orig</td><td>angular limit for refinement in theta &amp; phi (radians). </td></tr>
    <tr><td class="paramname">hires</td><td>high resolution limit. </td></tr>
    <tr><td class="paramname">lores</td><td>low resolution limit. </td></tr>
    <tr><td class="paramname">shiftlimit_orig</td><td>maximum shift from the original position (binned units). </td></tr>
    <tr><td class="paramname">shiftlimitz_orig</td><td>maximum z-shift from the original position (binned units). </td></tr>
    <tr><td class="paramname">shiftlimitxy_orig</td><td>maximum xy-shift from the original position (binned units). </td></tr>
    <tr><td class="paramname">mindist</td><td>minimun distance for cc peaks (binned units). </td></tr>
    <tr><td class="paramname">bin</td><td>binning for map, template and mask </td></tr>
    <tr><td class="paramname">*sym</td><td>symmetry to generate a list of views for search mode </td></tr>
    <tr><td class="paramname">iters</td><td>number of iterations in refine </td></tr>
    <tr><td class="paramname">refinepeaks</td><td>flag to run several iterations in refine </td></tr>
    <tr><td class="paramname">ccmax_file</td><td>file for cross-correlation map (max ccc for each position and rotation of the template) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>double the best correlation coefficient. <pre class="fragment">The template is rotated and cross-correlated to find fits above the
    threshold.
</pre> </dd></dl>

</div>
</div>
<a id="a166ec7a4246c114763304fbc7a9aaa8f" name="a166ec7a4246c114763304fbc7a9aaa8f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a166ec7a4246c114763304fbc7a9aaa8f">&#9670;&nbsp;</a></span>reconstruction_search_subtomo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">long reconstruction_search_subtomo </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_breconstruction.html">Breconstruction</a> *&#160;</td>
          <td class="paramname"><em>rec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>ptemp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>pmask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>pmask2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>alpha_step</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>theta_step</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>phi_step</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>alpha_limit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>thetaphi_limit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>hires</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>lores</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>shiftlimit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>mindist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>threshold</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxhits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_vector3.html">Vector3</a>&lt; long &gt;&#160;</td>
          <td class="paramname"><em>bin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_bsymmetry.html">Bsymmetry</a> &amp;&#160;</td>
          <td class="paramname"><em>sym</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>refinepeaks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_bstring.html">Bstring</a>&#160;</td>
          <td class="paramname"><em>ccmax_file</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="mg__subtomo_8h.html">mg_subtomo.h</a></li>
    <li class="footer">Generated on Fri Jan 7 2022 02:32:16 for Bsoft by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
