<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bsoft: /Users/bernard/b20/bsoft/include/mg_ctf_fit.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Bsoft_icon128.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Bsoft
   &#160;<span id="projectnumber">2.1.0</span>
   </div>
   <div id="projectbrief">Bernard&#39;s software package</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('mg__ctf__fit_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">mg_ctf_fit.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Header file for CTF (contrast transfer function) functions.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="rwimg_8h_source.html">rwimg.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="ctf_8h_source.html">ctf.h</a>&quot;</code><br />
</div>
<p><a href="mg__ctf__fit_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a17fa37bc462141fb9a71bbe253d45a85"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mg__ctf__fit_8h.html#a17fa37bc462141fb9a71bbe253d45a85">img_ctf_radial_average</a> (<a class="el" href="class_bimage.html">Bimage</a> *p, long n, <a class="el" href="class_c_t_fparam.html">CTFparam</a> &amp;em_ctf)</td></tr>
<tr class="memdesc:a17fa37bc462141fb9a71bbe253d45a85"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the power spectrum radial average corrected for astigmatism.  <a href="mg__ctf__fit_8h.html#a17fa37bc462141fb9a71bbe253d45a85">More...</a><br /></td></tr>
<tr class="separator:a17fa37bc462141fb9a71bbe253d45a85"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39a0c06ad0e5a580c38e8cfa056251af"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mg__ctf__fit_8h.html#a39a0c06ad0e5a580c38e8cfa056251af">img_ctf_fit</a> (<a class="el" href="class_bimage.html">Bimage</a> *p, long n, <a class="el" href="class_c_t_fparam.html">CTFparam</a> &amp;em_ctf, double lores, double hires, double def_start=1e3, double def_end=2e5, double def_inc=1e3, int flag=0)</td></tr>
<tr class="memdesc:a39a0c06ad0e5a580c38e8cfa056251af"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determines the CTF parameters from a power spectrum.  <a href="mg__ctf__fit_8h.html#a39a0c06ad0e5a580c38e8cfa056251af">More...</a><br /></td></tr>
<tr class="separator:a39a0c06ad0e5a580c38e8cfa056251af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a914828856f28065d3daceb2a1c2cd21b"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mg__ctf__fit_8h.html#a914828856f28065d3daceb2a1c2cd21b">img_ctf_isotropy</a> (<a class="el" href="class_bimage.html">Bimage</a> *p, long n, double lores, double hires)</td></tr>
<tr class="separator:a914828856f28065d3daceb2a1c2cd21b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a804fa46726d940f0c0ed88f2da0a6825"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mg__ctf__fit_8h.html#a804fa46726d940f0c0ed88f2da0a6825">img_ctf_fit_baseline</a> (<a class="el" href="class_bimage.html">Bimage</a> *p, long n, <a class="el" href="class_c_t_fparam.html">CTFparam</a> &amp;em_ctf, double lores, double hires)</td></tr>
<tr class="memdesc:a804fa46726d940f0c0ed88f2da0a6825"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fits only the baseline for a given CTF.  <a href="mg__ctf__fit_8h.html#a804fa46726d940f0c0ed88f2da0a6825">More...</a><br /></td></tr>
<tr class="separator:a804fa46726d940f0c0ed88f2da0a6825"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0cc671d77d351f03aa631bb40927eca"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mg__ctf__fit_8h.html#ac0cc671d77d351f03aa631bb40927eca">img_ctf_fit_envelope</a> (<a class="el" href="class_bimage.html">Bimage</a> *p, long n, <a class="el" href="class_c_t_fparam.html">CTFparam</a> &amp;em_ctf, double lores, double hires)</td></tr>
<tr class="memdesc:ac0cc671d77d351f03aa631bb40927eca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fits only the envelope for a given CTF.  <a href="mg__ctf__fit_8h.html#ac0cc671d77d351f03aa631bb40927eca">More...</a><br /></td></tr>
<tr class="separator:ac0cc671d77d351f03aa631bb40927eca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af985f1e858d119ade8d519e2f14ed128"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mg__ctf__fit_8h.html#af985f1e858d119ade8d519e2f14ed128">ctf_find_defocus</a> (vector&lt; double &gt; &amp;v, <a class="el" href="class_c_t_fparam.html">CTFparam</a> &amp;em_ctf, long rmin, long rmax, double step_size, double def_start, double def_end, double def_inc)</td></tr>
<tr class="separator:af985f1e858d119ade8d519e2f14ed128"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1989e9d1c03ba60781fa02d0b5e7d402"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mg__ctf__fit_8h.html#a1989e9d1c03ba60781fa02d0b5e7d402">img_ctf_find_defocus</a> (<a class="el" href="class_bimage.html">Bimage</a> *p, long n, <a class="el" href="class_c_t_fparam.html">CTFparam</a> &amp;em_ctf, double lores, double hires, double def_start=1e3, double def_end=2e5, double def_inc=1e3)</td></tr>
<tr class="memdesc:a1989e9d1c03ba60781fa02d0b5e7d402"><td class="mdescLeft">&#160;</td><td class="mdescRight">Searches for the defocus based on correlation.  <a href="mg__ctf__fit_8h.html#a1989e9d1c03ba60781fa02d0b5e7d402">More...</a><br /></td></tr>
<tr class="separator:a1989e9d1c03ba60781fa02d0b5e7d402"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a67531ca1d0884d83e11cf25873f1e95b"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mg__ctf__fit_8h.html#a67531ca1d0884d83e11cf25873f1e95b">img_ctf_fit_astigmatism</a> (<a class="el" href="class_bimage.html">Bimage</a> *p, long n, <a class="el" href="class_c_t_fparam.html">CTFparam</a> &amp;em_ctf, double lores, double hires)</td></tr>
<tr class="memdesc:a67531ca1d0884d83e11cf25873f1e95b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fits the astigmatism with a given defocus, baseline and envelope.  <a href="mg__ctf__fit_8h.html#a67531ca1d0884d83e11cf25873f1e95b">More...</a><br /></td></tr>
<tr class="separator:a67531ca1d0884d83e11cf25873f1e95b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ac841c36d48f32c91f0439f905d9ceb"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mg__ctf__fit_8h.html#a2ac841c36d48f32c91f0439f905d9ceb">img_water_ring_index</a> (<a class="el" href="class_bimage.html">Bimage</a> *p, long img_num, <a class="el" href="class_c_t_fparam.html">CTFparam</a> &amp;em_ctf)</td></tr>
<tr class="memdesc:a2ac841c36d48f32c91f0439f905d9ceb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the water ring index from a power spectrum.  <a href="mg__ctf__fit_8h.html#a2ac841c36d48f32c91f0439f905d9ceb">More...</a><br /></td></tr>
<tr class="separator:a2ac841c36d48f32c91f0439f905d9ceb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2220d1b5ffa128bfeeedffbb5fa5dfc"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mg__ctf__fit_8h.html#ac2220d1b5ffa128bfeeedffbb5fa5dfc">img_water_ring_index</a> (<a class="el" href="class_bimage.html">Bimage</a> *prad)</td></tr>
<tr class="memdesc:ac2220d1b5ffa128bfeeedffbb5fa5dfc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the water ring index from a power spectrum.  <a href="mg__ctf__fit_8h.html#ac2220d1b5ffa128bfeeedffbb5fa5dfc">More...</a><br /></td></tr>
<tr class="separator:ac2220d1b5ffa128bfeeedffbb5fa5dfc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Header file for CTF (contrast transfer function) functions. </p>
<dl class="section author"><dt>Author</dt><dd>Bernard Heymann </dd></dl>
<dl class="section date"><dt>Date</dt><dd>Created: 20000426 </dd>
<dd>
Modified: 20210813 </dd></dl>

<p class="definition">Definition in file <a class="el" href="mg__ctf__fit_8h_source.html">mg_ctf_fit.h</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="af985f1e858d119ade8d519e2f14ed128"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af985f1e858d119ade8d519e2f14ed128">&#9670;&nbsp;</a></span>ctf_find_defocus()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double ctf_find_defocus </td>
          <td>(</td>
          <td class="paramtype">vector&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_c_t_fparam.html">CTFparam</a> &amp;&#160;</td>
          <td class="paramname"><em>em_ctf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>rmin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>rmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>step_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>def_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>def_end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>def_inc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mg__ctf__fit_8cpp_source.html#l00498">498</a> of file <a class="el" href="mg__ctf__fit_8cpp_source.html">mg_ctf_fit.cpp</a>.</p>

</div>
</div>
<a id="a1989e9d1c03ba60781fa02d0b5e7d402"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1989e9d1c03ba60781fa02d0b5e7d402">&#9670;&nbsp;</a></span>img_ctf_find_defocus()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double img_ctf_find_defocus </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_c_t_fparam.html">CTFparam</a> &amp;&#160;</td>
          <td class="paramname"><em>em_ctf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>lores</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>hires</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>def_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>def_end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>def_inc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Searches for the defocus based on correlation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*p</td><td>image structure. </td></tr>
    <tr><td class="paramname">n</td><td>sub-image number. </td></tr>
    <tr><td class="paramname">&amp;em_ctf</td><td>CTF parameter structure. </td></tr>
    <tr><td class="paramname">lores</td><td>low resolution limit. </td></tr>
    <tr><td class="paramname">hires</td><td>high resolution limit. </td></tr>
    <tr><td class="paramname">def_start</td><td>defocus search start (default 1e3). </td></tr>
    <tr><td class="paramname">def_end</td><td>defocus search end (default 2e5). </td></tr>
    <tr><td class="paramname">def_inc</td><td>defocus search increment (default 1e3). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>double R factor. <pre class="fragment">A radial power spectrum is calculated.
A range of defocus values is tested (1000-200000 angstrom, 0.1-20 um), 
and the best fitting value accepted.
The new parameters are written into the CTFparam structure.
</pre> </dd></dl>

<p class="definition">Definition at line <a class="el" href="mg__ctf__fit_8cpp_source.html#l00600">600</a> of file <a class="el" href="mg__ctf__fit_8cpp_source.html">mg_ctf_fit.cpp</a>.</p>

</div>
</div>
<a id="a39a0c06ad0e5a580c38e8cfa056251af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39a0c06ad0e5a580c38e8cfa056251af">&#9670;&nbsp;</a></span>img_ctf_fit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double img_ctf_fit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_c_t_fparam.html">CTFparam</a> &amp;&#160;</td>
          <td class="paramname"><em>em_ctf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>lores</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>hires</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>def_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>def_end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>def_inc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Determines the CTF parameters from a power spectrum. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*p</td><td>image structure. </td></tr>
    <tr><td class="paramname">n</td><td>sub-image number. </td></tr>
    <tr><td class="paramname">&amp;em_ctf</td><td>CTF parameter structure. </td></tr>
    <tr><td class="paramname">lores</td><td>low resolution limit. </td></tr>
    <tr><td class="paramname">hires</td><td>high resolution limit </td></tr>
    <tr><td class="paramname">def_start</td><td>defocus search start (default 1e3). </td></tr>
    <tr><td class="paramname">def_end</td><td>defocus search end (default 2e5). </td></tr>
    <tr><td class="paramname">def_inc</td><td>defocus search increment (default 1e3). </td></tr>
    <tr><td class="paramname">flag</td><td>flag to determine astigmatism. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>double water ring index. <pre class="fragment">Input: Power spectrum or its logarithm.
A radial power spectrum is calculated.
A range of defocus values is tested (100-200000 angstrom, 0.01-20 um), 
defining the baseline as passing through the zeroes for each defocus 
and fitting it to a 4th order polynomial.
The envelope function is a simple gaussian on top of the baseline and
fitted to minimize the RMSD between the calculated curve and the
radial power spectrum logarithm.
The fitting is limited to the spatial frequency range between the 
first and last zeroes.
Defocus values are positive for underfocus.
Functions:
    angle = atan(y/x)
    s2 = reciprocal space distance squared
    defocus_average = (defocus_max + defocus_min)/2
    defocus_deviation = (defocus_max - defocus_min)/2
    defocus = defocus_average + defocus_deviation*cos(2*(angle - astigmatism_angle))
    phase = 0.5*PI*lambda*lambda*lambda*Cs*s2*s2 - PI*lambda*defocus*s2 - amp_shift;
    CTF = sin(phase)
The new parameters are written into the CTPparam structure.
</pre> </dd></dl>

<p class="definition">Definition at line <a class="el" href="mg__ctf__fit_8cpp_source.html#l00211">211</a> of file <a class="el" href="mg__ctf__fit_8cpp_source.html">mg_ctf_fit.cpp</a>.</p>

</div>
</div>
<a id="a67531ca1d0884d83e11cf25873f1e95b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a67531ca1d0884d83e11cf25873f1e95b">&#9670;&nbsp;</a></span>img_ctf_fit_astigmatism()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double img_ctf_fit_astigmatism </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_c_t_fparam.html">CTFparam</a> &amp;&#160;</td>
          <td class="paramname"><em>em_ctf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>lores</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>hires</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fits the astigmatism with a given defocus, baseline and envelope. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*p</td><td>image structure. </td></tr>
    <tr><td class="paramname">n</td><td>sub-image number. </td></tr>
    <tr><td class="paramname">&amp;em_ctf</td><td>CTF parameter structure. </td></tr>
    <tr><td class="paramname">lores</td><td>low resolution limit. </td></tr>
    <tr><td class="paramname">hires</td><td>high resolution limit </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>double objective measure (larger is better). <pre class="fragment">A radial power spectrum is calculated and the baseline subtracted.
The defocus deviation starts from a low value to get an estimate of
the astigmatism angle. The defocus deviation is modified nased on
the direction of improvements in the fit, at each iteration 
narrowing the angular search for the astigmatism angle.
The new parameters are written into the CTFparam structure.
</pre> </dd></dl>

<p class="definition">Definition at line <a class="el" href="mg__ctf__fit_8cpp_source.html#l00766">766</a> of file <a class="el" href="mg__ctf__fit_8cpp_source.html">mg_ctf_fit.cpp</a>.</p>

</div>
</div>
<a id="a804fa46726d940f0c0ed88f2da0a6825"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a804fa46726d940f0c0ed88f2da0a6825">&#9670;&nbsp;</a></span>img_ctf_fit_baseline()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double img_ctf_fit_baseline </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_c_t_fparam.html">CTFparam</a> &amp;&#160;</td>
          <td class="paramname"><em>em_ctf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>lores</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>hires</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fits only the baseline for a given CTF. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*p</td><td>image structure. </td></tr>
    <tr><td class="paramname">n</td><td>sub-image number. </td></tr>
    <tr><td class="paramname">&amp;em_ctf</td><td>CTF parameter structure. </td></tr>
    <tr><td class="paramname">lores</td><td>low resolution limit. </td></tr>
    <tr><td class="paramname">hires</td><td>high resolution limit </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>double R factor. <pre class="fragment">A radial power spectrum is calculated incorporating astigmatism.
The baseline of the required type is fit.
The new parameters are written into the CTFparam structure.
</pre> </dd></dl>

<p class="definition">Definition at line <a class="el" href="mg__ctf__fit_8cpp_source.html#l00424">424</a> of file <a class="el" href="mg__ctf__fit_8cpp_source.html">mg_ctf_fit.cpp</a>.</p>

</div>
</div>
<a id="ac0cc671d77d351f03aa631bb40927eca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0cc671d77d351f03aa631bb40927eca">&#9670;&nbsp;</a></span>img_ctf_fit_envelope()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double img_ctf_fit_envelope </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_c_t_fparam.html">CTFparam</a> &amp;&#160;</td>
          <td class="paramname"><em>em_ctf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>lores</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>hires</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fits only the envelope for a given CTF. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*p</td><td>image structure. </td></tr>
    <tr><td class="paramname">n</td><td>sub-image number. </td></tr>
    <tr><td class="paramname">*em_ctf</td><td>CTF parameter structure. </td></tr>
    <tr><td class="paramname">lores</td><td>low resolution limit. </td></tr>
    <tr><td class="paramname">hires</td><td>high resolution limit </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>double R factor. <pre class="fragment">A radial power spectrum is calculated incorporating astigmatism.
The envelope is fit.
The new parameters are written into the CTFparam structure.
</pre> </dd></dl>

<p class="definition">Definition at line <a class="el" href="mg__ctf__fit_8cpp_source.html#l00457">457</a> of file <a class="el" href="mg__ctf__fit_8cpp_source.html">mg_ctf_fit.cpp</a>.</p>

</div>
</div>
<a id="a914828856f28065d3daceb2a1c2cd21b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a914828856f28065d3daceb2a1c2cd21b">&#9670;&nbsp;</a></span>img_ctf_isotropy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double img_ctf_isotropy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>lores</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>hires</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a17fa37bc462141fb9a71bbe253d45a85"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17fa37bc462141fb9a71bbe253d45a85">&#9670;&nbsp;</a></span>img_ctf_radial_average()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_bimage.html">Bimage</a>* img_ctf_radial_average </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_c_t_fparam.html">CTFparam</a> &amp;&#160;</td>
          <td class="paramname"><em>em_ctf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the power spectrum radial average corrected for astigmatism. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*p</td><td>image structure. </td></tr>
    <tr><td class="paramname">n</td><td>sub-image number. </td></tr>
    <tr><td class="paramname">&amp;em_ctf</td><td>CTF parameter structure. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Bimage* radial average, NULL on error. <pre class="fragment">A power spectrum with its origin at the center.
Functions:
    angle = atan(y/x) - astigmatism_angle
    s2 = reciprocal space distance squared
    defocus_min = defocus_avg - defocus_dev
    defocus_max = defocus_avg + defocus_dev
    smin2 = 1 - defocus_dev/defocus_avg
    smax2 = 1 + defocus_dev/defocus_avg
    radius = sqrt(2*s2*(smax2*cos(angle)*cos(angle)+
                smin2*sin(angle)*sin(angle))/(smax2+smin2))
The radial average is returned as a new 1D image.
</pre> </dd></dl>

<p class="definition">Definition at line <a class="el" href="mg__ctf__fit_8cpp_source.html#l00046">46</a> of file <a class="el" href="mg__ctf__fit_8cpp_source.html">mg_ctf_fit.cpp</a>.</p>

</div>
</div>
<a id="a2ac841c36d48f32c91f0439f905d9ceb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ac841c36d48f32c91f0439f905d9ceb">&#9670;&nbsp;</a></span>img_water_ring_index() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double img_water_ring_index </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>img_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_c_t_fparam.html">CTFparam</a> &amp;&#160;</td>
          <td class="paramname"><em>em_ctf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the water ring index from a power spectrum. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*p</td><td>power spectrum. </td></tr>
    <tr><td class="paramname">img_num</td><td>sub-image number. </td></tr>
    <tr><td class="paramname">&amp;em_ctf</td><td>CTF parameter structure. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>double water ing index. <pre class="fragment">A radial power spectrum is calculated.
The the water ring index is defined as:
    wri = wp/b - 1
where wp is the intensity at s=0.26 (3.8 Å) and b is the background.
The background is estimated as the average of sections before and after 
the water peak:
    b1 between s=0.1 and s=0.2
    b2 between s=0.3 and s=0.4
</pre> </dd></dl>

<p class="definition">Definition at line <a class="el" href="mg__ctf__fit_8cpp_source.html#l00860">860</a> of file <a class="el" href="mg__ctf__fit_8cpp_source.html">mg_ctf_fit.cpp</a>.</p>

</div>
</div>
<a id="ac2220d1b5ffa128bfeeedffbb5fa5dfc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac2220d1b5ffa128bfeeedffbb5fa5dfc">&#9670;&nbsp;</a></span>img_water_ring_index() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double img_water_ring_index </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>prad</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the water ring index from a power spectrum. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*prad</td><td>radial power spectrum. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>double water ing index. <pre class="fragment">The the water ring index is defined as:
    wri = wp/b - 1
where wp is the average intensity between 0.2 and 0.3, covering the 
peak at s=0.26 (3.8 Å).
The background, b, is estimated as the average of sections before and after 
the water peak:
    b1 between s=0.1 and s=0.2
    b2 between s=0.3 and s=0.4
</pre> </dd></dl>

<p class="definition">Definition at line <a class="el" href="mg__ctf__fit_8cpp_source.html#l00889">889</a> of file <a class="el" href="mg__ctf__fit_8cpp_source.html">mg_ctf_fit.cpp</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="mg__ctf__fit_8h.html">mg_ctf_fit.h</a></li>
    <li class="footer">Generated on Wed Sep 1 2021 09:22:02 for Bsoft by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
