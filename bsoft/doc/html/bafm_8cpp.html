<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bsoft: /Users/heymannb/b20/bsoft/src/bafm.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Bsoft_icon128.jpg"/></td>
  <td id="projectalign">
   <div id="projectname">Bsoft<span id="projectnumber">&#160;2.1.4</span>
   </div>
   <div id="projectbrief">Bernard&#39;s software package</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('bafm_8cpp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">bafm.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Simulation of AFM experiments.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="rwimg_8h.html">rwimg.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="utilities_8h.html">utilities.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="options_8h.html">options.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="timer_8h.html">timer.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a20a77efc352c9397dafad62ea926d8c4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bafm_8cpp.html#a20a77efc352c9397dafad62ea926d8c4">afm_generate_tip</a> (<a class="el" href="class_vector3.html">Vector3</a>&lt; long &gt; size, <a class="el" href="class_vector3.html">Vector3</a>&lt; double &gt; sampling, double radius, double <a class="el" href="_vector3_8h.html#ae39c57d147eeec4507b1687fed37f53e">angle</a>, double resolution)</td></tr>
<tr class="memdesc:a20a77efc352c9397dafad62ea926d8c4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates a rounded conical AFM tip.  <a href="bafm_8cpp.html#a20a77efc352c9397dafad62ea926d8c4">More...</a><br /></td></tr>
<tr class="separator:a20a77efc352c9397dafad62ea926d8c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b42389f51e32bf10ebf4a8bc7866865"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_bplot.html">Bplot</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bafm_8cpp.html#a6b42389f51e32bf10ebf4a8bc7866865">afm_simulate</a> (<a class="el" href="class_bimage.html">Bimage</a> *ptip, <a class="el" href="class_bimage.html">Bimage</a> *p, double spring, double modulus, double thick)</td></tr>
<tr class="memdesc:a6b42389f51e32bf10ebf4a8bc7866865"><td class="mdescLeft">&#160;</td><td class="mdescRight">Simulates and AFM experiment.  <a href="bafm_8cpp.html#a6b42389f51e32bf10ebf4a8bc7866865">More...</a><br /></td></tr>
<tr class="separator:a6b42389f51e32bf10ebf4a8bc7866865"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65530fd7bc528b0921461434c0b23b27"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bafm_8cpp.html#a65530fd7bc528b0921461434c0b23b27">afm_force_to_height</a> (<a class="el" href="class_bimage.html">Bimage</a> *pf, double force_step)</td></tr>
<tr class="memdesc:a65530fd7bc528b0921461434c0b23b27"><td class="mdescLeft">&#160;</td><td class="mdescRight">Converts an AFM force map into a set of 2D height images at different constant force values.  <a href="bafm_8cpp.html#a65530fd7bc528b0921461434c0b23b27">More...</a><br /></td></tr>
<tr class="separator:a65530fd7bc528b0921461434c0b23b27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bafm_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>
<tr class="separator:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab423cecac450e84f99ee6c5b62c95b80"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bafm_8cpp.html#ab423cecac450e84f99ee6c5b62c95b80">afm_simulate_at_xy</a> (<a class="el" href="class_bimage.html">Bimage</a> *ptip, <a class="el" href="class_bimage.html">Bimage</a> *p, long ii, float *force, double spring, double modulus, double thick)</td></tr>
<tr class="separator:ab423cecac450e84f99ee6c5b62c95b80"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a0b2caeb4b6f130be43e5a2f0267dd453"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bafm_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a></td></tr>
<tr class="separator:a0b2caeb4b6f130be43e5a2f0267dd453"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4de0ad4c7190962494815c0fa7f948df"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bafm_8cpp.html#a4de0ad4c7190962494815c0fa7f948df">use</a> []</td></tr>
<tr class="separator:a4de0ad4c7190962494815c0fa7f948df"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Simulation of AFM experiments. </p>
<dl class="section author"><dt>Author</dt><dd>Bernard Heymann </dd></dl>
<dl class="section date"><dt>Date</dt><dd>Created: 19990124 </dd>
<dd>
Modified: 20170612 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a65530fd7bc528b0921461434c0b23b27" name="a65530fd7bc528b0921461434c0b23b27"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a65530fd7bc528b0921461434c0b23b27">&#9670;&nbsp;</a></span>afm_force_to_height()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_bimage.html">Bimage</a> * afm_force_to_height </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>pf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>force_step</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Converts an AFM force map into a set of 2D height images at different constant force values. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*pf</td><td>force map. </td></tr>
    <tr><td class="paramname">force_step</td><td>force intervals for height images </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>*ph height images. </dd></dl>

</div>
</div>
<a id="a20a77efc352c9397dafad62ea926d8c4" name="a20a77efc352c9397dafad62ea926d8c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a20a77efc352c9397dafad62ea926d8c4">&#9670;&nbsp;</a></span>afm_generate_tip()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_bimage.html">Bimage</a> * afm_generate_tip </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_vector3.html">Vector3</a>&lt; long &gt;&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_vector3.html">Vector3</a>&lt; double &gt;&#160;</td>
          <td class="paramname"><em>sampling</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>radius</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>angle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>resolution</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Generates a rounded conical AFM tip. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">size</td><td>size of the tip density </td></tr>
    <tr><td class="paramname">sampling</td><td>sampling/spacing (in angstrom/pixel) </td></tr>
    <tr><td class="paramname">radius</td><td>radius of the tip curvature (in angstrom) </td></tr>
    <tr><td class="paramname">angle</td><td>angle of the tip side (in radians) </td></tr>
    <tr><td class="paramname">resolution</td><td>the resolution affects the tip surface softness </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Bimage* tip 3D map. <pre class="fragment">A 2D image of a conical tip is generated, with a 45 degree angle and
a rounding tip with the desired radius and softness.
The 2D image is then converted to a 3D surface using the function 
img_to_surface and returned.  The density of beta-silicon nitride
of 1.925 Da/A3 is used.
</pre> </dd></dl>

</div>
</div>
<a id="a6b42389f51e32bf10ebf4a8bc7866865" name="a6b42389f51e32bf10ebf4a8bc7866865"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b42389f51e32bf10ebf4a8bc7866865">&#9670;&nbsp;</a></span>afm_simulate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_bplot.html">Bplot</a> * afm_simulate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>ptip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>spring</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>modulus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>thick</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Simulates and AFM experiment. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*ptip</td><td>AFM tip density map - converted to force map. </td></tr>
    <tr><td class="paramname">*p</td><td>specimen density map. </td></tr>
    <tr><td class="paramname">spring</td><td>AFM cantilever spring constant (N/m). </td></tr>
    <tr><td class="paramname">modulus</td><td>bulk modules (N/m2). </td></tr>
    <tr><td class="paramname">thick</td><td>sample thickness (angstrom). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Bplot* force curve. <pre class="fragment">The elastic force on an AFM tip is calculated as:
    F = kt*dz = kb*dV/d
where   kt is the cantilever spring constant, typically 0.01 - 0.1 N/m.
        dz is the tip displacement due to specimen interaction.
        kb is the bulk modulus of the specimen, typically 1e9 N/m2.
        dV is the volume of the specimen displaced by the tip. This
            volume is here approximated as the density overlap volume.
        d is the specimen thickness in angstrom.
The tip is positioned at each point (x,y,z) in the density map and the
overlap volume calculated (i.e., a type of convolution).  This tip
position corresponds to a zero displacement.  The correct tip position
is found by shifting the tip upwards (in the z-direction) until the 
displacement and elastic forces are approximately equal.  The tip 
displacement is refined by interpolation and the force calculated.  
The force map is returned in place of the original density map.
Forces are calculated in piconewton. 
The origin of the tip density is taken as nx/2, ny/2, 0.
</pre> </dd></dl>

</div>
</div>
<a id="ab423cecac450e84f99ee6c5b62c95b80" name="ab423cecac450e84f99ee6c5b62c95b80"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab423cecac450e84f99ee6c5b62c95b80">&#9670;&nbsp;</a></span>afm_simulate_at_xy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int afm_simulate_at_xy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>ptip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_bimage.html">Bimage</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>ii</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>force</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>spring</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>modulus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>thick</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a3c04138a5bfe5d72780bb7e82a18e627" name="a3c04138a5bfe5d72780bb7e82a18e627"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c04138a5bfe5d72780bb7e82a18e627">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a4de0ad4c7190962494815c0fa7f948df" name="a4de0ad4c7190962494815c0fa7f948df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4de0ad4c7190962494815c0fa7f948df">&#9670;&nbsp;</a></span>use</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* use[]</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a0b2caeb4b6f130be43e5a2f0267dd453" name="a0b2caeb4b6f130be43e5a2f0267dd453"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b2caeb4b6f130be43e5a2f0267dd453">&#9670;&nbsp;</a></span>verbose</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int verbose</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="bafm_8cpp.html">bafm.cpp</a></li>
    <li class="footer">Generated on Fri Jan 7 2022 02:32:17 for Bsoft by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
